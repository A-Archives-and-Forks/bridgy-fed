{% extends "base.html" %}

{% block title %}ATProto state - Bridgy Fed{% endblock %}

{% block content %}

<h3>ATProto state</h3>
<ul>
<li>Current subscribers:
  <ul>
  {% for nsid, subs in subscribers.items() %}
  <li>{{ nsid }}
  <ul>
    {% for s in subs %}
      {% set host = gethostbyaddr(s.ip) %}
      {% set pt = pytz.timezone('US/Pacific') %}
      <li {% if host and (host == 'bsky' or host.endswith('.zayo.com')) %}style="background-color: lightgreen"{% endif %}>
        {{ s.ip }} {{ host }} {{s.user_agent }} {{ s.args }} {{ s.start.astimezone(pt) }}
    {% endfor %}
  <ul>
  {% endfor %}
  </ul>
</ul>
</h3>

{% endblock %}
