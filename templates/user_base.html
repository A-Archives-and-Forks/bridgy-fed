{% extends "base.html" %}

{% block title %}{{ id }} {{ tab }} - Bridgy Fed{% endblock %}

{% block content %}

{% if g.user.LABEL == 'web' %}
{% if g.user.has_redirects == False %}
<div class="row promo warning">
<form method="post" action="/web-site">
  Next step:
  <a href="/docs#redirect+these+URL+paths">
    add the .well-known redirects.
  </a>
  <input type="hidden" name="url" value="{{ g.user.web_url() }}" />
  <input type="submit" class="btn btn-default" value="Check now" />
</form>

{% if g.user.redirects_error %}
<details class="small">
  {{ g.user.redirects_error|safe }}
</details>
{% endif %}
</div>
{% endif %}

{% if g.user.has_hcard == False %}
<div class="row promo warning">
<form method="post" action="/web-site">
  Next step: <a href="/docs#profile">add a representative h-card.</a>
  <input type="hidden" name="url" value="{{ g.user.web_url() }}" />
  <input type="submit" class="btn btn-default" value="Check now" />
</form>
</div>
{% endif %}
{% endif %}

<div class="row">
  <span class="big">
    {{ g.user.user_link()|safe }}
    &middot;
    <nobr>
      <a href="{{ g.user.web_url() }}"
         title="{{ g.user.__class__.__name__ }} (native)">
        <span class="logo">{{ g.user.LOGO_HTML }}</span>
        {{ g.user.handle_or_id() }}</a>

    <!-- TODO: make this work with protocols other than Web -->
    <form method="post" action="/webmention-interactive">
      <input name="source" type="hidden" value="{{ g.user.web_url() }}" />
      <button id="update-profile-button" type="submit" title="Update profile"
              class="btn btn-default glyphicon glyphicon-refresh"></button>
    </form>
    </nobr>
    &middot;
  </span>

  {% for proto in set(PROTOCOLS.values()) %}
    {% if proto and not isinstance(g.user, proto)
       and proto.LABEL not in ('atproto', 'ui') %}
      <nobr title="{{ proto.__name__ }} (bridged)">
        <span class="logo">{{ proto.LOGO_HTML|safe }}</span>
        {{ g.user.ap_address() }}
      </nobr>
    {% endif %}
  {% endfor %}
</div>

<!-- tabs -->
<div class="row tabs">
  <a class="left-tab"></a>
  <a href="{{ g.user.user_page_path() }}"
     {% if tab == 'profile' %}class="active-tab"{% endif %}
     >👤 Profile</a><a
   href="{{ g.user.user_page_path('home') }}"
     {% if tab == 'home' %}class="active-tab"{% endif %}
     >🏠 Feed</a><a
   href="{{ g.user.user_page_path('notifications') }}"
     {% if tab == 'notifications' %}class="active-tab"{% endif %}
     >🔔 Notifications</a>
  <a class="right-tab"></a>
</div>

{% block subtabs %}
{% endblock subtabs %}

{% block feed %}
{% include "activities.html" %}
{% endblock feed %}

{% endblock content %}
